<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Change Password - SBOM CVE Scanner</title>
  <link rel="stylesheet" href="/static/css/style.css" />
  <style>
    .change-container { max-width: 400px; margin: 80px auto; background: var(--bg-panel); border: 1px solid var(--border); padding: 32px 28px; border-radius: 6px; box-shadow: 0 2px 16px #0002; }
    .change-title { font-family: var(--cond); font-size: 24px; font-weight: 700; color: var(--green); margin-bottom: 18px; text-align: center; }
    .change-form { display: flex; flex-direction: column; gap: 18px; }
    .change-label { font-family: var(--cond); font-size: 12px; color: var(--text-dim); margin-bottom: 4px; }
    .change-input { width: 100%; padding: 10px 14px; font-size: 15px; border: 1px solid var(--border); background: var(--bg); color: var(--text); border-radius: 2px; font-family: var(--mono); }
    .change-input:focus { border-color: var(--green-dim); outline: none; }
    .change-btn { background: var(--green); color: #000; font-family: var(--cond); font-size: 15px; font-weight: 700; letter-spacing: 0.1em; padding: 12px 0; border: none; border-radius: 2px; cursor: pointer; transition: background 0.2s; }
    .change-btn:hover { background: var(--green-dim); }
    .change-error { color: var(--red); font-size: 13px; text-align: center; margin-top: 8px; }
    .change-success { color: var(--green); font-size: 13px; text-align: center; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="change-container">
    <div class="change-title">Change Password</div>
    <form class="change-form" id="change-form">
      <div>
        <label class="change-label" for="old_password">Current Password</label>
        <input class="change-input" type="password" id="old_password" name="old_password" required autocomplete="current-password" />
      </div>
      <div>
        <label class="change-label" for="new_password">New Password</label>
        <input class="change-input" type="password" id="new_password" name="new_password" required autocomplete="new-password" />
      </div>
      <button class="change-btn" type="submit">Change Password</button>
      <div class="change-error" id="change-error" style="display:none;"></div>
      <div class="change-success" id="change-success" style="display:none;"></div>
    </form>
  </div>
  <script>
    document.getElementById('change-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const old_password = document.getElementById('old_password').value;
      const new_password = document.getElementById('new_password').value;
      const errorDiv = document.getElementById('change-error');
      const successDiv = document.getElementById('change-success');
      errorDiv.style.display = 'none';
      successDiv.style.display = 'none';
      try {
        const resp = await fetch('/api/change-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          credentials: 'include',
          body: new URLSearchParams({ old_password, new_password })
        });
        if (resp.ok) {
          successDiv.textContent = 'Password changed successfully! Redirecting...';
          successDiv.style.display = 'block';
          setTimeout(() => { window.location.href = '/'; }, 1200);
        } else {
          const data = await resp.json();
          errorDiv.textContent = data.detail || 'Password change failed.';
          errorDiv.style.display = 'block';
        }
      } catch (err) {
        errorDiv.textContent = 'Network error.';
        errorDiv.style.display = 'block';
      }
    });
  </script>
</body>
</html>

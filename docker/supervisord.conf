[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=10MB
logfile_backups=3
loglevel=info
pidfile=/var/run/supervisord.pid

; ── MariaDB ─────────────────────────────────────────────────────────────────
[program:mariadb]
command=/usr/sbin/mysqld --user=mysql --bind-address=127.0.0.1
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/mariadb.log
stdout_logfile_maxbytes=5MB
stderr_logfile=/var/log/supervisor/mariadb-err.log
stderr_logfile_maxbytes=5MB
startsecs=5
startretries=3

; ── FastAPI (uvicorn) ─────────────────────────────────────────────────────────
[program:uvicorn]
command=/usr/local/bin/uvicorn main:app
    --host 0.0.0.0
    --port 8000
    --workers 2
    --log-level info
directory=/app/backend
autostart=true
autorestart=true
priority=20
; Wait for MariaDB to be ready before starting
startsecs=8
startretries=5
stdout_logfile=/var/log/supervisor/uvicorn.log
stdout_logfile_maxbytes=10MB
stderr_logfile=/var/log/supervisor/uvicorn-err.log
stderr_logfile_maxbytes=10MB
environment=PYTHONUNBUFFERED="1",PYTHONDONTWRITEBYTECODE="1"
